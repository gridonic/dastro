---
import pkg from '../../../package.json';

const { environmentSwitch, draftMode, config } = Astro.locals.dastro;

const { isDraftModeEnabled } = draftMode();
const {
  isDatoEnvironmentSwitchAllowed,
  usesDefaultDatoEnvironment,
  getDatoEnvironment,
} = environmentSwitch();

const env = config.environment || 'no env';
const draftModeEnabled = isDraftModeEnabled(Astro);

const datoEnvironment = {
  switchAllowed: isDatoEnvironmentSwitchAllowed(),
  isDefault: usesDefaultDatoEnvironment(Astro),
  environment: getDatoEnvironment(Astro),
};

const dastroVersion = pkg.version;
---

<div
  class="debug-view"
  data-debug-view
  data-environment={env}
  data-draft-mode-enabled={draftModeEnabled}
  data-dastro-version={dastroVersion}
>
  <div class="toggle">
    <input
      class="checkbox"
      type="checkbox"
      id="debug-view-show-panel"
      name="debug-view-show-panel"
      data-shortcut="d"
    />
    <label
      class="label"
      for="debug-view-show-panel"
      data-debug-drag-handle
      aria-label="Toggle Debug View"
    >
      <svg class="icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_6080_3145)">
          <path
            d="M0.96875 8H15.0312"
            stroke="white"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
          <path
            d="M8 0.96875V15.0312"
            stroke="white"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </g>
        <defs>
          <clipPath id="clip0_6080_3145">
            <rect width="16" height="16" fill="white"></rect>
          </clipPath>
        </defs>
      </svg>
    </label>
  </div>
  <div class="panel">
    <div class="titlebar" data-debug-drag-handle>
      <div class="title">Gridonic Debug Panel</div>
      <label
        class="toggle"
        for="debug-view-show-panel"
        data-debug-ignore-drag
        aria-label="Close Debug View"
      >
        <svg
          class="icon"
          viewBox="0 0 16 16"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M3.02815 3.02815L12.9718 12.9718"
            stroke="white"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
          <path
            d="M12.9718 3.02815L3.02816 12.9718"
            stroke="white"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </label>
    </div>

    <div class="details">
      <div class="detail">Dastro v{dastroVersion}</div>
      <div class="detail">{env} Environment</div>
      <div class="detail _hidden-vs">Large Viewport</div>
      <div class="detail _hidden-vl">Small Viewport</div>
    </div>

    <div class="variables">
      <div class="title">Variables</div>
      <pre
        class="list"
        data-debug-variables>
        <span class="variable" data-variable="--fluid-rem" data-type="font-size" />
        <span class="variable" data-variable="--fluid-outer-margin" data-type="height" />
        <span class="variable" data-variable="--scrollbar-width" data-type="width" />
      </pre>
    </div>

    <div class="checkboxes">
      <div class="title">Info Overlays</div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-variables"
          name="debug-view-show-variables"
          data-shortcut="v"
        />
        <label for="debug-view-show-variables">
          <span class="label-text">Variables</span>
          <span class="shortcut">Ctrl + V</span>
        </label>
      </div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-module-names"
          name="debug-view-show-module-names"
          data-shortcut="m"
        />
        <label for="debug-view-show-module-names">
          <span class="label-text">Module Names</span>
          <span class="shortcut">Ctrl + M</span>
        </label>
      </div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-content-height"
          name="debug-view-show-content-height"
          data-shortcut="h"
        />
        <label for="debug-view-show-content-height">
          <span class="label-text"
            >Content Height <span data-contentheight-ratio></span></span
          >
          <span class="shortcut">Ctrl + H</span>
        </label>
      </div>
      <div class="title">Layout Tools</div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-grid"
          name="debug-view-show-grid"
          data-shortcut="g"
        />
        <label for="debug-view-show-grid">
          <span class="label-text">Grid</span>
          <span class="shortcut">Ctrl + G</span>
        </label>
      </div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-module-outlines"
          name="debug-view-show-module-outlines"
          data-shortcut="o"
        />
        <label for="debug-view-show-module-outlines">
          <span class="label-text">Module Outlines</span>
          <span class="shortcut">Ctrl + O</span>
        </label>
      </div>
      <div class="checkbox">
        <input
          type="checkbox"
          id="debug-view-show-box-model"
          name="debug-view-show-box-model"
          data-shortcut="b"
        />
        <label for="debug-view-show-box-model">
          <span class="label-text">Box Model</span>
          <span class="shortcut">Ctrl + B</span>
        </label>
      </div>
    </div>

    {
      datoEnvironment.switchAllowed && (
        <div
          class="datoenvironment"
          class:list={{ '-custom': !datoEnvironment.isDefault }}
        >
          <div class="status">
            <div class="title">DatoCMS Environment</div>
            <div class="value">{datoEnvironment.environment}</div>
          </div>
          <button type="button" class="button debug-view-button">
            Switch Environment
          </button>
        </div>
      )
    }

    <div
      class="draftmode"
      class:list={`-${draftModeEnabled ? 'enabled' : 'disabled'}`}
    >
      <div class="status">
        <div class="title">Draft Mode</div>
        <div class="value -enabled">enabled</div>
        <div class="value -disabled">disabled</div>
      </div>
      <button type="button" class="button debug-view-button"
        >Toggle Draft Mode</button
      >
    </div>
  </div>

  <div class="contentheight" data-contentheight></div>
</div>

<script>
  import { log } from '../../client';
  import { registerComponent, BaseComponent } from '../../client';

  registerComponent(
    '[data-debug-view]',
    class DebugView extends BaseComponent {
      private draftModeEnabled = false;
      private environment: string = '';
      private readonly dragStorageKey = 'debug-view-position';
      private dragPointerId: number | null = null;
      private dragPosition = { x: 0, y: 0 };
      private dragStart = { x: 0, y: 0 };
      private dragOrigin = { x: 0, y: 0 };
      private isDragging = false;
      private activeDragHandle: HTMLElement | null = null;

      init() {
        window.addEventListener('DOMContentLoaded', () => this.recalculate());
        window.addEventListener('resize', () => this.recalculate());

        this.bindCheckboxEvents();
        this.loadCheckboxState();
        this.bindKeyboardShortcuts();
        this.bindDraftModeEvents();
        this.bindEnvironmentSwitchEvents();
        this.restorePanelPosition();
        this.bindDragHandles();

        log.debug('Using dastro version ');

        log.debug(
          'Debug View Keyboard Shortcuts\n' +
            '-----------------------------\n' +
            'Ctrl + D: Debug Panel\n' +
            'Ctrl + V: Variables\n' +
            'Ctrl + G: Grid\n' +
            'Ctrl + M: Module Names\n' +
            'Ctrl + O: Module Outlines\n' +
            'Ctrl + B: Box Model\n' +
            'Ctrl + H: Content Height\n',
        );

        log.debug(`Dastro Version: ${this.$el.dataset.dastroVersion ?? '?'}`);

        this.draftModeEnabled = this.$el.dataset.draftModeEnabled === 'true';
        log.debug(`Draft Mode enabled: ${this.draftModeEnabled.toString()}`);

        this.environment = this.$el.dataset.environment ?? '?';
        log.debug(`Environment: ${this.environment}`);

        log.debug(
          `Alpine: ${'Alpine' in globalThis ? Alpine.version : 'not activated'}`,
        );
      }

      bindCheckboxEvents() {
        const checkboxes = this.$el.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((checkbox) => {
          checkbox.addEventListener(
            'change',
            this.saveCheckboxState.bind(this),
          );
          checkbox.addEventListener(
            'update-checkbox',
            this.saveCheckboxState.bind(this),
          );
        });
      }

      bindKeyboardShortcuts() {
        window.addEventListener('keydown', (event) => {
          if (event.ctrlKey && event.key.length === 1) {
            const checkbox = this.$el.querySelector(
              `input[type="checkbox"][data-shortcut="${event.key.toLowerCase()}"]`,
            );

            if (checkbox instanceof HTMLInputElement) {
              event.preventDefault();
              checkbox.checked = !checkbox.checked;

              checkbox.dispatchEvent(new Event('change', { bubbles: true }));
            }
          }
        });
      }

      private saveCheckboxState(event: Event) {
        const checkbox = event.target as HTMLInputElement;
        if (checkbox) {
          localStorage.setItem(checkbox.id, checkbox.checked.toString());
        }
      }

      private loadCheckboxState() {
        const checkboxes = this.$el.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((checkbox) => {
          const savedState = localStorage.getItem(checkbox.id);
          if (savedState !== null) {
            (checkbox as HTMLInputElement).checked = savedState === 'true';
          }
        });
      }

      private bindDraftModeEvents() {
        const toggle = this.$el.querySelector('.draftmode .button');
        toggle?.addEventListener('click', () => {
          if (this.draftModeEnabled) {
            window.location.href = '/api/cms/draft-mode/disable';
          } else {
            const token =
              this.environment !== 'local'
                ? prompt('Enter a token to toggle draft mode')
                : '';
            window.location.href = `/api/cms/draft-mode/enable?token=${token}`;
          }
        });
      }

      private bindEnvironmentSwitchEvents() {
        const switcher = this.$el.querySelector('.datoenvironment .button');
        switcher?.addEventListener('click', () => {
          const targetEnvironment = prompt('Enter target environment');

          const token =
            this.environment !== 'local'
              ? prompt('Enter a token to toggle draft mode')
              : '';

          window.location.href = `/api/cms/environment/switch?token=${token}&environment=${targetEnvironment}`;
        });
      }

      private recalculate() {
        const debugVariablesElement = this.$el.querySelector(
          '[data-debug-variables]',
        );
        if (!debugVariablesElement) {
          return;
        }
        [...debugVariablesElement.children].forEach(($c) => {
          if ($c instanceof HTMLElement) {
            const variable = $c.dataset.variable;
            const type = $c.dataset.type ?? 'height';
            if (!variable) {
              return;
            }

            const $temp = document.createElement('div');

            // Special handling for rem
            if (variable === '--fluid-rem') {
              $temp.style.fontSize = `var(${variable})`;
              document.documentElement.appendChild($temp);
            } else {
              $temp.style[type as any] = `var(${variable})`;
              $c.append($temp);
            }

            const computedValue = window
              .getComputedStyle($temp)
              .getPropertyValue(type);

            $temp.remove();
            $c.innerHTML = `${variable}: <b>${computedValue}</b>`;
          }
        });

        // Content Height
        const container = document.querySelector('[data-contentheight]');
        if (container) {
          container.innerHTML = '';

          const siteHeight = document.body.scrollHeight;
          const viewportHeight = window.innerHeight;
          const viewportCount = Math.floor(siteHeight / viewportHeight);

          for (let i = 0; i < viewportCount; i++) {
            const number = document.createElement('div');
            number.classList.add('number');
            number.innerText = (i + 1).toString();
            container.appendChild(number);
          }

          const ratio = (siteHeight / viewportHeight).toFixed(2);
          const ratioElement = document.querySelector(
            '[data-contentheight-ratio]',
          ) as HTMLElement;
          ratioElement.innerText = `(${ratio} viewports)`;
        }
      }

      private bindDragHandles() {
        const handles = this.$el.querySelectorAll<HTMLElement>(
          '[data-debug-drag-handle]',
        );
        handles.forEach((handle) => {
          handle.addEventListener('pointerdown', this.handleDragStart);
        });
      }

      private handleDragStart = (event: PointerEvent) => {
        if (event.button !== 0) {
          return;
        }

        const target = event.target as HTMLElement | null;
        if (target?.closest('[data-debug-ignore-drag]')) {
          return;
        }

        const handle = event.currentTarget as HTMLElement;
        this.activeDragHandle = handle;

        this.dragPointerId = event.pointerId;
        this.dragStart = { x: event.clientX, y: event.clientY };
        this.dragOrigin = { ...this.dragPosition };
        this.isDragging = false;

        window.addEventListener('pointermove', this.handleDragMove);
        window.addEventListener('pointerup', this.handleDragEnd);
      };

      private handleDragMove = (event: PointerEvent) => {
        if (this.dragPointerId !== event.pointerId) {
          return;
        }

        const deltaX = event.clientX - this.dragStart.x;
        const deltaY = event.clientY - this.dragStart.y;

        if (!this.isDragging) {
          if (Math.abs(deltaX) < 2 && Math.abs(deltaY) < 2) {
            return;
          }
          this.isDragging = true;
          this.activeDragHandle?.setPointerCapture?.(event.pointerId);
          this.toggleHandleDraggingState(true);
        }

        this.applyDragPosition({
          x: this.dragOrigin.x + deltaX,
          y: this.dragOrigin.y + deltaY,
        });
      };

      private handleDragEnd = (event: PointerEvent) => {
        if (this.dragPointerId !== event.pointerId) {
          return;
        }

        window.removeEventListener('pointermove', this.handleDragMove);
        window.removeEventListener('pointerup', this.handleDragEnd);

        this.dragPointerId = null;

        if (this.isDragging) {
          this.persistDragPosition();
          this.cancelNextClick();
          this.activeDragHandle?.releasePointerCapture?.(event.pointerId);
        }

        this.toggleHandleDraggingState(false);
        this.isDragging = false;
        this.activeDragHandle = null;
      };

      private applyDragPosition(position: { x: number; y: number }) {
        this.dragPosition = position;
        this.$el.style.setProperty('--debug-view-offset-x', `${position.x}px`);
        this.$el.style.setProperty('--debug-view-offset-y', `${position.y}px`);
      }

      private restorePanelPosition() {
        try {
          const stored = sessionStorage.getItem(this.dragStorageKey);
          if (!stored) {
            return;
          }

          const parsed = JSON.parse(stored);
          if (typeof parsed?.x === 'number' && typeof parsed?.y === 'number') {
            this.applyDragPosition(parsed);
          }
        } catch (error) {
          console.warn('Unable to restore Debug View position', error);
        }
      }

      private persistDragPosition() {
        try {
          sessionStorage.setItem(
            this.dragStorageKey,
            JSON.stringify(this.dragPosition),
          );
        } catch (error) {
          console.warn('Unable to persist Debug View position', error);
        }
      }

      private toggleHandleDraggingState(isDragging: boolean) {
        const handles = this.$el.querySelectorAll<HTMLElement>(
          '[data-debug-drag-handle]',
        );
        handles.forEach((handle) => {
          handle.classList.toggle('is-dragging', isDragging);
        });
      }

      private cancelNextClick() {
        if (!this.activeDragHandle) {
          return;
        }

        const handle = this.activeDragHandle;
        const suppressOnce = (event: MouseEvent) => {
          event.stopPropagation();
          event.preventDefault();
        };

        handle.addEventListener('click', suppressOnce, {
          capture: true,
          once: true,
        });
      }
    },
  );
</script>

<style lang="scss">
  :root {
    --debug-grid-name-line-opacity: 0.95;
    --debug-grid-column-opacity: 0.25;
    --debug-view-font-size: clamp(6px, 0.75rem, 10px);
  }

  .debug-view {
    font-family: system-ui;
    z-index: var(--z-debug);
    --debug-view-offset-x: 0px;
    --debug-view-offset-y: 0px;
    --debug-view-accent-color: rgba(40, 30, 213, 1);
    --debug-view-background-color: #fbfbfb;
    --debug-view-foreground-color: black;
    --debug-view-inverted-foreground-color: white;
    --debug-view-color-lines: #e3e1e1;
    --debug-view-color-positive: hsl(166, 95%, 30%);
    --debug-view-color-negative: hsl(2, 85%, 69%);

    > .toggle,
    > .panel {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      z-index: calc(var(--z-debug) + 100);
      transform: translate(
        var(--debug-view-offset-x),
        var(--debug-view-offset-y)
      );
    }

    > .toggle {
      background: var(--debug-view-accent-color);
      border-radius: 0.2rem;

      > .checkbox {
        display: none;
      }

      > .label {
        display: block;
        padding: 0.5rem;
        cursor: grab;

        > .icon {
          width: 1rem;
          height: 1rem;
        }
      }
    }

    > .panel {
      width: max-content;
      font-size: var(--debug-view-font-size);
      line-height: 125%;
      border-radius: 0.2rem;
      overflow: hidden;
      background-color: var(--debug-view-background-color);
      box-shadow:
        rgba(17, 17, 26, 0.1) 0 0.062rem 0,
        rgba(17, 17, 26, 0.1) 0 0.5rem 1.5rem,
        rgba(17, 17, 26, 0.1) 0 1rem 3rem;

      body:has(input#debug-view-show-panel:not(:checked)) & {
        display: none;
      }

      > .titlebar {
        display: flex;
        align-items: center;
        font-weight: bold;
        font-size: 0.75rem;
        padding: 0.75rem 1rem;
        position: relative;
        background: var(--debug-view-accent-color);
        color: var(--debug-view-inverted-foreground-color);
        user-select: none;

        > .toggle {
          margin-left: auto;
          cursor: pointer;

          > .icon {
            width: 1rem;
            height: 1rem;
          }
        }
      }

      &::before,
      > .environment {
        display: inline-block;
        padding-bottom: 0.5rem;
        font-weight: bold;
      }

      > .details {
        padding: 0.75rem 1rem;
        display: flex;
        gap: 0.25rem;
        background: var(--debug-view-background-color);

        > .detail {
          padding: 0.25rem 0.5rem;
          background: gray;
          color: var(--debug-view-inverted-foreground-color);
          border-radius: 0.25rem;
          text-transform: capitalize;
          cursor: default;
        }
      }

      // Variables
      > .variables {
        margin: 0;
        padding: 0.75rem 1rem;
        font-size: var(--debug-view-font-size);
        border-top: 1px solid var(--debug-view-color-lines);

        body:has(input#debug-view-show-variables:not(:checked)) & {
          display: none;
        }

        > .title {
          font-weight: bold;
          margin-bottom: 0.45rem;
          text-transform: uppercase;
          letter-spacing: 0.04em;
          font-size: 0.65rem;
          color: rgba(0, 0, 0, 0.6);
        }

        > .list {
          margin: 0;
          line-height: 160%;
          color: var(--debug-view-foreground-color);
          white-space: normal;

          > .variable {
            display: block;
          }
        }
      }

      > .checkboxes {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        padding: 0.8rem 1rem 1rem;
        border-top: 1px solid var(--debug-view-color-lines);

        > .title {
          font-weight: bold;
          margin-bottom: 0.125rem;
          text-transform: uppercase;
          letter-spacing: 0.04em;
          font-size: 0.65rem;
          color: rgba(0, 0, 0, 0.6);
        }

        * + .title {
          margin-top: 0.45rem;
        }

        > .checkbox {
          position: relative;
          display: flex;
          align-items: center;
          width: 100%;
        }

        > .checkbox > input {
          position: absolute;
          inset: 0;
          opacity: 0;
          pointer-events: none;
        }

        > .checkbox > label {
          position: relative;
          display: inline-flex;
          align-items: center;
          justify-content: space-between;
          gap: 0.5rem;
          width: 100%;
          padding: 0.45rem 0.75rem 0.45rem 0.6rem;
          border-radius: 0.4rem;
          border: 1px solid var(--debug-view-color-lines);
          background: white;
          cursor: pointer;
          transition:
            border-color 0.15s ease,
            box-shadow 0.15s ease,
            transform 0.15s ease;
          font-weight: 600;
        }

        > .checkbox > label::before {
          content: '';
          width: 0.9rem;
          height: 0.9rem;
          border-radius: 0.2rem;
          border: 1px solid var(--debug-view-color-lines);
          transition:
            border-color 0.15s ease,
            background 0.15s ease,
            box-shadow 0.15s ease,
            color 0.15s ease;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          font-size: 0.6rem;
          font-weight: 700;
          color: transparent;
        }

        > .checkbox > label:hover,
        > .checkbox > label:focus-visible {
          border-color: var(--debug-view-accent-color);
          box-shadow: 0 0 0 1px var(--debug-view-accent-color);
        }

        > .checkbox > input:checked + label {
          border-color: var(--debug-view-accent-color);
          box-shadow: 0 0 0 1px rgba(40, 30, 213, 0.35);
        }

        > .checkbox > input:checked + label::before {
          background: var(--debug-view-accent-color);
          border-color: var(--debug-view-accent-color);
          color: var(--debug-view-inverted-foreground-color);
          content: 'âœ“';
        }

        > .checkbox > input:focus-visible + label {
          outline: 2px solid var(--debug-view-accent-color);
          outline-offset: 2px;
        }

        > .checkbox > label > .label-text {
          flex: 1;
          line-height: 1.2;
        }

        > .checkbox > label > .shortcut {
          align-self: center;
          font-size: 0.6rem;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          padding: 0.15rem 0.45rem;
          border-radius: 0.4rem;
          background: rgba(40, 30, 213, 0.1);
          color: var(--debug-view-accent-color);
          font-weight: 700;
          white-space: nowrap;
          opacity: 0;
          transform: translateY(-0.2rem);
          transition:
            opacity 0.15s ease,
            transform 0.15s ease;
        }

        > .checkbox > label:hover > .shortcut,
        > .checkbox > label:focus-visible > .shortcut {
          opacity: 1;
          transform: translateY(0);
        }
      }

      > .datoenvironment {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--debug-view-color-lines);

        &.-custom {
          > .disabled {
            display: none;
          }
        }

        &:not(.-custom) {
          > .enabled {
            display: none;
          }
        }

        > .status {
          > .title {
            font-weight: bold;
            margin-bottom: 0.125rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            font-size: 0.65rem;
            color: rgba(0, 0, 0, 0.6);
          }
        }

        > .button {
          margin-left: auto;
        }
      }

      > .draftmode {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1rem;

        &.-enabled {
          background: var(--debug-view-color-negative);

          > .status > .value.-disabled {
            display: none;
          }
        }

        &.-disabled {
          background: var(--debug-view-color-positive);

          > .status > .value.-enabled {
            display: none;
          }
        }

        > .status {
          > .title {
            font-weight: bold;
            margin-bottom: 0.125rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            font-size: 0.65rem;
            color: rgba(0, 0, 0, 0.6);
          }
        }

        > .button {
          margin-left: auto;
        }
      }
    }

    // Content Height
    > .contentheight {
      // Hide if checkbox is not ticked
      body:has(input#debug-view-show-content-height:not(:checked)) & {
        display: none;
      }

      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        #f37178 3rem,
        transparent 3rem,
        transparent calc(50% - 3rem),
        #f37178 calc(50% - 3rem),
        #f37178 50%,
        #00e599 50%,
        #00e599 calc(50% + 3rem),
        transparent calc(50% + 3rem),
        transparent calc(100% - 3rem),
        #00e599 calc(100% - 3rem)
      );
      background-size: 100% 200vh;
      background-repeat: repeat-y;
      z-index: var(--z-debug);
      opacity: 0.25;
      pointer-events: none;

      :global(> .number) {
        display: flex;
        height: 100vh;
        align-items: center;
        justify-content: center;
        font-size: 26rem;
        color: #00e599;

        &:nth-child(odd) {
          color: #f37178;
        }
      }
    }
  }

  // Module Names
  :global(body:has(input#debug-view-show-module-names:checked) [data-module]) {
    position: relative;

    &::before {
      content: attr(data-module);
      display: block;
      position: absolute;
      top: 50%;
      right: 0;
      transform: translateY(-50%) rotate(180deg);
      overflow: hidden;
      writing-mode: tb-rl;
      white-space: nowrap;
      background: CanvasText;
      color: Canvas;
      padding: 1em;
      font-size: var(--debug-view-font-size);
      line-height: 1.25;
      font-family: system-ui;
      font-weight: bold;
      z-index: calc(var(--z-debug) - 1);
    }
  }

  // Box Model
  :global(
    body:has(input#debug-view-show-box-model:checked)
      :is(.header, .main, .footer)
      *
  ),
  :global(
    body:has(input#debug-view-show-box-model:checked)
      :is(.header, .main, .footer)
      *::before
  ),
  :global(
    body:has(input#debug-view-show-box-model:checked)
      :is(.header, .main, .footer)
      *::after
  ) {
    outline: 1px dotted rgba(80, 225, 255, 0.9);
  }

  // Module Outlines
  :global(
    body:has(input#debug-view-show-module-outlines:checked) [data-module]
  ) {
    outline: 0.25rem solid rgba(186, 225, 255, 0.9);
    outline-offset: -0.25rem;
  }

  .debug-view [data-debug-drag-handle] {
    cursor: grab;
  }

  .debug-view [data-debug-drag-handle].is-dragging {
    cursor: grabbing;
  }

  .debug-view-button {
    padding: 0.5rem 0.75rem;
    background: var(--debug-view-accent-color);
    color: var(--debug-view-inverted-foreground-color);
    border-radius: 0.25rem;
    border: none;
  }
</style>
